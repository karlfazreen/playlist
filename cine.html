[<!DOCTYPE html>
<html>
<head>
  <style>
    div a img { visibility: hidden; }
    body { margin: 0; background-color: black; }
  </style>
  <meta name='viewport' content='width=device-width, initial-scale=1.0' />
  <meta name="referrer" content="no-referrer" />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.11.11/shaka-player.ui.min.js' crossorigin='anonymous'></script>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.11.11/controls.min.css' crossorigin='anonymous' />
</head>
<body>
  <center><b><p style="color:white; opacity:0.27;"></p></b></center>
  <div data-shaka-player-container style='position:absolute; z-index: -1; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;'>
    <video autoplay data-shaka-player poster="https://telegra.ph/file/5aa654602c9e8c9754a04.jpg" id='video' style='width:100%;height:100%;'></video>
  </div>

  <script>
    async function fetchMPD() {
      try {
        const response = await fetch("https://data.iknowyou.workers.dev/tukeno.m3u");
        const text = await response.text();

        const blocks = text.split('#KODIPROP').map(b => '#KODIPROP' + b);
        for (const block of blocks) {
          if (block.includes('tvg-id="AstroAEC"')) {
            const mpdMatch = block.match(/https?:\/\/[^\s]+\.mpd/);
            if (mpdMatch) {
              return mpdMatch[0];
            }
          }
        }

        throw new Error("MPD URL untuk tvg-id=\"AstroAEC\" tidak ditemukan.");
      } catch (error) {
        console.error("Gagal fetch MPD:", error);
        return null;
      }
    }

    async function initPlayer() {
      const manifestUri = await fetchMPD();
      if (!manifestUri) {
        console.error("MPD tidak tersedia.");
        return;
      }

      const video = document.getElementById('video');
      const ui = video['ui'];
      const controls = ui.getControls();
      const player = controls.getPlayer();
      window.player = player;
      window.ui = ui;

      player.configure({
        drm: {
          "clearKeys": {
            "3f726fd5cbbf5944437a4dbfab431b10": "376b009796e4ad50ea8f68d796676692",
            "0b65326aede3edbe81e6fb40317d5310": "8412f444ffbe350cf2ece051f9152e90",
            "84bf9ad6848be7db20f9d16823deef10": "654f2d25a5bfb27c9e5ae0852584a166",
            "499a8f368064b11cc092b7b013db0710": "e151bb81468a8426d6ab12860d314aa3",
            "62a7b7917aad5123cd4df65c561c7010": "b1effa9e51cf38b3ae676bc264937efb",
            "5be66a6f88efee3d6e30f72a9c58e310": "168f3fadfc730ba3dfc932f7c430e27d",
            "6ff0e040d544ec3f02243865990f0c10": "83728b47019abdbb37aa36ed5f2951bd",
            "06282157da4e8f97623a70ed017fad10": "8da72ca8501a4deb4bfc381fe1737ef4"
          },
        },
        abr: {
          defaultBandwidthEstimate: 16888,
          enabled: true,
          restrictions: {
            minHeight: 359,
            maxHeight: 720
          }
        },
      });

      player.addEventListener('error', onPlayerErrorEvent);
      controls.addEventListener('error', onUIErrorEvent);

      try {
        await player.load(manifestUri);
        console.log('Video berhasil dimuat dari:', manifestUri);
      } catch (error) {
        console.error('Gagal memuat video dari:', manifestUri, 'Error:', error);
      }
    }

    function onPlayerErrorEvent(errorEvent) {
      onPlayerError(errorEvent.detail);
    }

    function onPlayerError(error) {
      console.error('Error code', error.code, 'object', error);
    }

    function onUIErrorEvent(errorEvent) {
      onPlayerError(errorEvent.detail);
    }

    function initFailed(errorEvent) {
      console.error('Unable to load the UI library!');
    }

    document.addEventListener('shaka-ui-loaded', () => initPlayer());
    document.addEventListener('shaka-ui-load-failed', initFailed);
  </script>
</body>
</html>]
