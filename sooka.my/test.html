<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ClearKey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.min.js"></script>
</head>
<body>
    <video id="video" controls autoplay></video>
    <script>
        async function initPlayer() {
            const video = document.getElementById('video');
            const player = new shaka.Player(video);

            // Set ClearKey DRM dengan obfuscation (hexadecimal escape sequences)
            const clearKeys = {};
            clearKeys[
                "\x31\x65\x63\x65\x33\x65\x63\x62\x34\x31\x36\x39\x39\x65\x38\x35\x35\x63\x36\x64\x63\x39\x61\x32\x38\x33\x39\x30\x38\x32\x31\x30"
            ] = "\x62\x61\x30\x38\x62\x65\x37\x36\x37\x65\x31\x61\x35\x65\x38\x39\x37\x37\x37\x65\x36\x38\x61\x36\x39\x39\x38\x61\x38\x63\x31\x39";

            player.configure({ drm: { clearKeys: clearKeys } });

            // Tambah User-Agent pada permintaan
            player.getNetworkingEngine().registerRequestFilter((type, request) => {
                if (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
                    type === shaka.net.NetworkingEngine.RequestType.SEGMENT) {
                    request.headers['User-Agent'] =
                        "Mozilla/5.0 (Linux; Android 12; Pixel 3a XL Build/SP2A.220505.008; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/114.0.5715.0 Mobile Safari/537.36";
                }
            });

            try {
                await player.load("https://linearjitp-playback.astro.com.my/dash-wv/linear/5108/default_primary.mpd");
                console.log("Strim dimuatkan dengan jayanya!");
            } catch (error) {
                console.error("Ralat Shaka:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
